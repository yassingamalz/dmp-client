<!-- src/app/features/statistics/components/stats-dashboard/stats-dashboard.component.html -->
<div class="stats-dashboard">
  <!-- Period Selector -->
  <div class="period-selector">
    <div class="period-buttons">
      <button 
        *ngFor="let period of periods" 
        class="period-btn"
        [class.active]="selectedPeriod === period.key"
        (click)="selectedPeriod = period.key">
        {{ period.label }}
      </button>
    </div>
  </div>

  <!-- Machine Statistics Grid -->
  <div class="machine-stats-grid">
    <!-- Loading Skeleton -->
    <div *ngIf="loading" class="skeleton-container">
      <div *ngFor="let item of getSkeletonItems(); let i = index" 
           class="machine-card skeleton"
           [style.animation-delay]="i * 0.1 + 's'">
        <div class="machine-header skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-rate"></div>
        </div>
        <div class="machine-body skeleton-content">
          <div class="skeleton-stat"></div>
          <div class="skeleton-stat"></div>
          <div class="skeleton-stat"></div>
        </div>
      </div>
    </div>

    <!-- Actual Machine Cards -->
    <div *ngIf="!loading && statistics?.machineStats" class="machine-cards">
      <div *ngFor="let machine of statistics!.machineStats; let i = index" 
           class="machine-card"
           [class]="getMachineStatusClass(machine)"
           [style.animation-delay]="i * 0.1 + 's'">
        
        <div class="machine-header">
          <div class="machine-info">
            <h3 class="machine-name">{{ machine.machineName }}</h3>
            <div class="machine-id">{{ machine.machineId }}</div>
          </div>
          
          <div class="success-rate-indicator">
            <div class="rate-circle" [class]="getSuccessRateClass(machine[selectedPeriod].successRate)">
              <i [class]="'bi ' + getSuccessRateIcon(machine[selectedPeriod].successRate)"></i>
              <span class="rate-value">{{ machine[selectedPeriod].successRate }}%</span>
            </div>
          </div>
        </div>

        <div class="machine-body">
          <div class="stats-row">
            <div class="stat-item">
              <div class="stat-icon processed">
                <i class="bi bi-files"></i>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ formatNumber(machine[selectedPeriod].processed) }}</div>
                <div class="stat-label">Elaborati</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon success">
                <i class="bi bi-check-circle-fill"></i>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ formatNumber(machine[selectedPeriod].done) }}</div>
                <div class="stat-label">Completati</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon error">
                <i class="bi bi-x-circle-fill"></i>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ formatNumber(machine[selectedPeriod].errors) }}</div>
                <div class="stat-label">Errori</div>
              </div>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill success" 
                   [style.width.%]="(machine[selectedPeriod].done / machine[selectedPeriod].processed) * 100">
              </div>
              <div class="progress-fill error" 
                   [style.width.%]="(machine[selectedPeriod].errors / machine[selectedPeriod].processed) * 100">
              </div>
            </div>
            <div class="progress-labels">
              <span class="progress-label success">{{ (machine[selectedPeriod].done / machine[selectedPeriod].processed * 100).toFixed(1) }}% Successo</span>
              <span class="progress-label error">{{ (machine[selectedPeriod].errors / machine[selectedPeriod].processed * 100).toFixed(1) }}% Errori</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && (!statistics?.machineStats || statistics!.machineStats.length === 0)" 
         class="empty-state">
      <i class="bi bi-graph-down"></i>
      <h3>Nessuna Statistica Disponibile</h3>
      <p>Non ci sono dati di elaborazione da mostrare per il periodo selezionato.</p>
    </div>
  </div>

  <!-- Recent Errors Section -->
  <div *ngIf="statistics?.recentErrors && statistics!.recentErrors.length > 0" class="recent-errors">
    <div class="card">
      <div class="card-header">
        <div class="card-icon error">
          <i class="bi bi-exclamation-triangle-fill"></i>
        </div>
        <h3 class="card-title">Errori Recenti</h3>
      </div>
      <div class="card-body">
        <div class="error-list">
          <div *ngFor="let error of statistics!.recentErrors.slice(0, 5)" class="error-item">
            <div class="error-info">
              <div class="error-file">{{ error.fileName }}</div>
              <div class="error-meta">
                {{ error.machineId }} • {{ error.timestamp | date:'short' }}
                <span *ngIf="error.order"> • Ordine: {{ error.order }}</span>
              </div>
            </div>
            <div class="error-reason">{{ error.errorReason }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>